# 上线部署常规文档

## 部署的原则

名词解释：

1. 稳定版本：当前正在生产环境使用的版本
2. 发布版本：新程序需要上线部署的版本
3. 线下发布版本：与发布版本完全相同，部署在线下测试服务器上


1. 三层分开部署上线，依次为DAL、BLL、VIEW
2. 发布版本只有程序是在生产服务器上，连接的是虚拟数据库
3. 分层上线是指DAL先部署至发布版本，然后进行测试，测试成功后，再由发布版本转换成正式版本，再测试，成功后方可进行下一个层BLL的切换版本
4. 所有程序上线后，保留线下发布版和发布版



现统一对所有程序上线要做的工作梳理如下：

#### 一、虚拟主机

每一套程序（不论是哪一层），在生产服务器上都需要有两个虚拟主机，一个为正式的，一个是线上切换的

例如：

	DAL正式:  192.168.11.203:8001
	DAL切换:  192.168.11.203:8003
	
	BLL正式:  192.168.11.203:8002
	BLL切换:  192.168.11.203:8004
		
	云平台正式：  www.ljyun.com
	云平台切换：  www.ljyun_new.com
	
#### 二、虚拟数据库

1. 本地pc建立虚拟数据库
2. 请使用最新的线上数据库作为虚拟数据库的数据基础

#### 三、修改程序

1. DAL层需要支持数据库地址统一切换
2. BLL层需要支持DAL接口地址统一切换
3. view保证不直接读取DAL，且对BLL的地址可统一切换
4. 各层程序个性化配置文件修改

## 测试的原则

#### 一、DAL测试

1. 找出diff比对后的记过，区分没有修改的接口，新增接口，被修改的老接口
2. 可以通过编程或者浏览器插件的形式，对被修改的老接口进行测试
3. 因为数据库为虚拟库，因此可以任意测试，不需要清理测试数据

#### 二、BLL测试

BLL测试的时候，DAL必须保证完全正确并且已经进入稳定版。（但BLL发布版的测试还是链接DAL的发布版）

1. 有单元测试的全部跑单元测试
2. 没有单元测试的接口等VIEW上线后再测试

#### 三、VIEW测试

上两层这时已经部署完毕

1. 先上发布版，进行测试


