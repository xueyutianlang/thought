## 数据结构\_排序_堆排序

### 一、算法特性

下标|0|1|2|3|4|5|6|7|8
:--|:--|:--|:--|:--|:--|:--|:--|:--|:--
--|tmp|5|2|1|6|9|3|8|7

> 记得选择排序吗？如果当前下标为1，我们把它的值5赋值给tmp，然后循环和后面的值进行比较，取出最大值9存入下标1，然后把tmp的值赋值给下标5，这就执行了一次（降序）循环，然后反复！

`有没有发现问题？？？`

`每个元素都要和其后的所有元素比对一遍！`

> 如果每次比对前，我就知道后面的那些元素中最大(小)值是谁，那就简单了！

第一次：最大值就在下标1，直接取走

下标|0|1|2|3|4|5|6|7|8
:--|:--|:--|:--|:--|:--|:--|:--|:--|:--
--|tmp|9|\*|\*|\*|\*|\*|\*|*

第二次：最大值还在下标1，直接取走

下标|0|1|2|3|4|5|6|7|8
:--|:--|:--|:--|:--|:--|:--|:--|:--|:--
--|tmp|8|\*|\*|\*|\*|\*|\*|

第三次：最大值也是下标1，取走

下标|0|1|2|3|4|5|6|7|8
:--|:--|:--|:--|:--|:--|:--|:--|:--|:--
--|tmp|7|\*|\*|\*|\*|\*||


第四次：一样喽～继续


### 二、堆的原理


`问题又来了！！！`

`数组的最大值每次都在下标1的位置上，是如何实现的？？`

下面的数据结构可以解决这个问题，本文以大顶堆描述，小顶堆原理相同：

> 数据结构：堆，其实很简单，就是一颗完全二叉树，元素之间具有一定的特殊关系

##### 元素之间的关系（大顶堆）

1. 除叶子结点外，`每个节点的值都大于其左右孩子的值。`
2. 根节点是最大值
3. 和二叉排序树不一样，不是左小右大！

> _如果我们把数组元素看成堆的元素，然后按照规则构造出大顶堆，那最大值不就是根节点！每次取走根节点，再做一次堆的创建，最大值又在根节点了_

##### 一个关键的规则

在学完全二叉树的时候，我们讲过：

一颗有n个节点的完全二叉树，对其任意节点i，则有：

1. 如果i=1，则为根节点，无双亲
2. 如果2i>n，则节点i没有左孩子
3. 如果2i+1>n，则节点i没有右孩子

其实堆在内存中还是采用原来的数组存储，只不过是在交换元素之间的位置，下面我们一边看代码实现（借用大话数据结构的代码）

### 三、代码实现

> 堆排序 ＝ 数组预处理（堆）＋ 排序（swap）

<img src="https://raw.githubusercontent.com/arkulo56/thought/master/images/datastruct/sort_dui_1.png" width="600" />

要排序的队列是｛50,10,90,30,70,40,80,60,20｝,这段代码就是我们说的，通过堆将数组的最大值处理到数组的下标1的位置上，然后用swap函数（排序）取走（这里它是交换到最后一个位置），然后再用堆将数组重新处理，等待下一次比对！

`这里又出现了新问题，为什么预处理的时候，循环是从L->lenth/2开始的？？？？`

看看下面这张图，在没有形成堆前，我们可以把这个数组看成这棵树，循环的次数就是这棵树的层数，看看四个灰色节点和其叶子节点的值就能找到规律


也就是：

1. s=>30, 2\*s=>60, 2*s+1=>20
2. s=>90, 2\*s=>40, 2*s+1=>80
3. s=>10, 2\*s=>30, 2*s+1=>70
4. s=>50, 2\*s=>10, 2*s+1=>90

> 根据这个规律，s从L->length/2开始，自下而上的求每个子树的最大值，然后换至根节点（子树）,然后这个子树根节点又会成为上一层节点的孩子节点

<img src="https://raw.githubusercontent.com/arkulo56/thought/master/images/datastruct/sort_dui_2.png" width="300" />


最后代码实现就是下面这张图，可以看到里面写了注释，其实就是自下而上，自右至左的按照刚才那棵树的位置，将最大值一步步的换到根节点的过程。

<img src="https://raw.githubusercontent.com/arkulo56/thought/master/images/datastruct/sort_dui_3.png" width="600" />

在每次swap将最小值交换至下标1的位置上后，调用HeapAdjust函数，只需要对第一层，也就是根节点进行调整，即可完成处理！！！！

<img src="https://raw.githubusercontent.com/arkulo56/thought/master/images/datastruct/sort_dui_4.png" width="400" />